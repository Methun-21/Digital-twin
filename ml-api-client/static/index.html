<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Parameter Sender</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            align-items: center;
        }

        label {
            font-weight: bold;
        }

        input {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 0.75rem 1.5rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        button:hover {
            background-color: #0056b3;
        }

        #response {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: none;
        }

        .config-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #e9ecef;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <h1>Manual Parameter Sender</h1>

    <div class="config-section">
        <h2>Configuration</h2>
        <div class="form-group">
            <label for="mlApiUrl">Friend's ML API URL:</label>
            <input type="text" id="mlApiUrl" value="http://localhost:8001" placeholder="http://192.168.1.X:8000">
        </div>
    </div>

    <form id="paramForm">
        <!-- Parameters will be generated here -->
    </form>

    <br>
    <button type="button" onclick="sendData()">Process & Send</button>

    <div id="response"></div>

    <script>
        const initialData = {
            "timestamp": 1770397819576,
            "machineId": "m1",
            "machineName": "M1-ALPHA",
            "rpm": 2535.02,
            "torque": 78.4,
            "loadWeight": 50,
            "motorTemp": 28.71,
            "windingTemp": 40.87,
            "bearingTemp": 25.02,
            "ambientTemp": 26.4,
            "vibrationX": 1.85,
            "vibrationY": 1.512,
            "vibrationZ": 1.174,
            "vibrationMagnitude": 2.662,
            "voltage": 395.22,
            "current": 37.65,
            "powerConsumption": 21.909,
            "powerFactor": 0.85,
            "harmonicDistortion": 2.22,
            "efficiency": 95,
            "operatingHours": 0,
            "startStopCycles": 1,
            "wearLevel": 0,
            "bearingWear": 0,
            "insulationResistance": 100,
            "humidity": 59.8,
            "isRunning": true
        };

        const form = document.getElementById('paramForm');

        // Dynamically create input fields
        for (const [key, value] of Object.entries(initialData)) {
            const group = document.createElement('div');
            group.className = 'form-group';

            const label = document.createElement('label');
            label.htmlFor = key;
            label.textContent = key;

            const input = document.createElement('input');
            input.id = key;
            input.name = key;
            if (typeof value === 'boolean') {
                input.type = 'checkbox';
                input.checked = value;
            } else if (typeof value === 'number') {
                input.type = 'number';
                input.step = 'any';
                input.value = value;
            } else {
                input.type = 'text';
                input.value = value;
            }

            group.appendChild(label);
            group.appendChild(input);
            form.appendChild(group);
        }

        async function sendData() {
            const formData = {};
            for (const [key, value] of Object.entries(initialData)) {
                const input = document.getElementById(key);
                if (typeof value === 'boolean') {
                    formData[key] = input.checked;
                } else if (typeof value === 'number') {
                    formData[key] = Number(input.value);
                } else {
                    formData[key] = input.value;
                }
            }

            const apiUrl = document.getElementById('mlApiUrl').value;
            const responseDiv = document.getElementById('response');
            responseDiv.style.display = 'block';
            responseDiv.textContent = 'Sending...';

            try {
                const response = await fetch('/send_critical_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...formData,
                        target_url: apiUrl // Send the target URL to our backend to proxy
                    }),
                });

                const result = await response.json();
                responseDiv.textContent = JSON.stringify(result, null, 2);
                responseDiv.style.borderColor = response.ok ? '#28a745' : '#dc3545';
            } catch (error) {
                responseDiv.textContent = 'Error: ' + error.message;
                responseDiv.style.borderColor = '#dc3545';
            }
        }
    </script>
</body>

</html>